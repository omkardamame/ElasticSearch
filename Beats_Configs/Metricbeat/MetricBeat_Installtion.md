
# MetricBeat Installation and Configuration

## Download the Appropriate RPM Package:

Your Elasticsearch version should match with the version of metricbeat.

```shell
curl -O -L https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.5.0-x86_64.rpm
```
instead of curl you can use wget as well if you want,

After Installation you have to open `/etc/metricbeat/metricbeat.yml` file for configuration.
```yaml
###################### Metricbeat Configuration Example #######################
# =========================== Modules configuration ============================

metricbeat.config.modules:
  # Glob pattern for configuration loading
  path: ${path.config}/modules.d/*.yml

  # Set to true to enable config reloading
  reload.enabled: false

  # Period on which files under path should be checked for changes
  #reload.period: 10s

# ======================= Elasticsearch template setting =======================

setup.template.settings:
  index.number_of_shards: 1
  index.codec: best_compression
  #_source.enabled: false
# =================================== Kibana ===================================

# Starting with Beats version 6.0.0, the dashboards are loaded via the Kibana API.
# This requires a Kibana endpoint configuration.
setup.kibana:
  host: "192.168.1.220:5601"
  username: "yourusername"
  password: "yourpassword"
  protocol: "https" #you can comment this if its in http protocol
  ssl.verification_mode: "none"  
  # Kibana Space ID
  # ID of the Kibana Space into which the dashboards should be loaded. By default,
  # the Default Space will be used.
  #space.id:
# ================================== Outputs ===================================

# Configure what output to use when sending the data collected by the beat.

# ---------------------------- Elasticsearch Output ----------------------------
output.elasticsearch:
  # Array of hosts to connect to.
  hosts: ["192.168.1.221:9200"]
  # Protocol - either `http` (default) or `https`.
  # Authentication credentials - either API key or username/password.
  #api_key: "id:api_key"
  username: "yourusername"
  password: "yourpassword"
  # Protocol - either `http` (default) or `https`.
  protocol: "https" #you can comment this if its in http protocol
  ssl.certificate_authorities: ["/etc/elasticsearch/certs/http_ca.crt"]
  # you can recyle the certificates of Elasticsearch here as well.
  # Authentication credentials - either API key or username/password.
# ================================= Processors =================================

# Configure processors to enhance or manipulate events generated by the beat.

processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
  - add_docker_metadata: ~
  - add_kubernetes_metadata: ~


# ================================== Logging ===================================

# Sets log level. The default log level is info.
# Available log levels are: error, warning, info, debug
#logging.level: debug

# At debug level, you can selectively enable logging only for some components.
# To enable all selectors use ["*"]. Examples of other selectors are "beat",
# "publisher", "service".
#logging.selectors: ["*"]

# ================================= Migration ==================================

# This allows to enable 6.7 migration aliases
#migration.6_to_7.enabled: true


```

[An example Configuration File](https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-reference-yml.html)

Now you have to Enable the modules that you want to monitor, For example :
```shell
metricbeat modules enable system
```

If you are on the Elasticsearch Server you can monitor elasticsearch as well using the same command, but instead of system you need to write elasticsearch :
```shell
metricbeat modules enable elasticsearch
```

If you want list of Modules that are available in metricbeat then use,
```shell
metricbeat modules list
```

After enabling the modules, their Config files will be located inside,
```shell
/etc/metricbeat/modules.d/"module_name.yml"
```

you have to edit them according to your needs, For Example `system.yml` 
``` file :
```yaml
# Module: system
# Docs: https://www.elastic.co/guide/en/beats/metricbeat/main/metricbeat-module-system.html

- module: system
  period: 10s
  metricsets:
    - cpu
    - load
    - memory
    - network
    - process
    - process_summary
    - socket_summary
    #- entropy
    - core
    - diskio
    #- socket
    - service
    #- users
  process.include_top_n:
    by_cpu: 10      # include top 5 processes by CPU
    by_memory: 10   # include top 5 processes by memory
# Configure the mount point of the hostâ€™s filesystem for use in monitoring a host from within a container
# hostfs: "/hostfs"

- module: system
  period: 100s
  metricsets:
    - filesystem
    - fsstat
  processors:
  - drop_event.when.regexp:
      system.filesystem.mount_point: '^/(sys|cgroup|proc|dev|etc|host|lib|snap)($|/)'

- module: system
  period: 10s
  metricsets:
    - uptime

#- module: system
#  period: 5m
#  metricsets:
#    - raid
#  raid.mount_point: '/'
```
[An example Config File](https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-module-system.html#_example_configuration_59)

After this you need to setup Metricbeat and load its Dashboards into Kibana using,
```shell
metricbeat setup -e
```

This is it, Now you should be able to see your dashboards in to Kibana after successful setup.
